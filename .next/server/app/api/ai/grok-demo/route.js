"use strict";(()=>{var e={};e.id=526,e.ids=[526],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4548:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{POST:()=>c});var i=r(9303),s=r(8716),o=r(670),a=r(7070),l=r(8227);let u={location:"Kyoto, Japan",plannedDays:4,flexibleDates:!1,departDate:"2025-11-10",returnDate:"2025-11-14",adults:2,children:0,travelStyleChoice:"answer-questions",travelStyleAnswers:{experience:["seasoned explorer"],vibes:["culture rich","relaxed"],sampleDays:["balanced"],dinnerChoices:["chef tasting menus"]},selectedInterests:["food","history","wellness"],selectedInclusions:["airport transfers","daily breakfast"],tripNickname:"Autumn Zen Escape",tripVibe:"slow luxury",additionalNotes:"Include at least one traditional tea ceremony and a private onsen experience."};async function c(e){let t=await p(e),r=(0,l.M)(t??u),n=await (0,l.y)({prompt:r,model:"grok-4-fast-reasoning",temperature:.4});return a.NextResponse.json({itinerary:n.itinerary,metadata:n.metadata})}async function p(e){try{if("0"===e.headers.get("content-length"))return null;return await e.json()}catch(e){return console.warn("Failed to parse grok demo payload",e instanceof Error?e.message:String(e)),null}}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ai/grok-demo/route",pathname:"/api/ai/grok-demo",filename:"route",bundlePath:"app/api/ai/grok-demo/route"},resolvedPagePath:"C:\\Users\\raze0\\Documents\\vercel_deploy\\hylo00_original\\src\\app\\api\\ai\\grok-demo\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:g}=d,m="/api/ai/grok-demo/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},8227:(e,t,r)=>{r.d(t,{M:()=>i,y:()=>s});var n=r(1202);function i(e){let t=[],r=e.indicator,n=e.query,i="string"==typeof r&&r.trim()?r:"string"==typeof n&&n.trim()?n:"general";t.push("You are Hylo's AI Itinerary Architect. Craft a detailed, actionable itinerary aligned with the indicator focus."),t.push(`Indicator: ${i}`),t.push(`Destination: ${e.location??"Unknown destination"}`),!0===e.flexibleDates?t.push(`Dates: Flexible, target ${e.plannedDays??"unspecified"} days.`):t.push(`Dates: ${e.departDate??"unspecified"} – ${e.returnDate??"unspecified"}.`);let s=e.adults??1,o=e.children??0;if(o>0){let r=(Array.isArray(e.childrenAges)?e.childrenAges:[]).map(e=>"number"!=typeof e||Number.isNaN(e)?null:e<2?`Infant (${e})`:e<5?`Toddler (${e})`:e<13?`Child (${e})`:e<18?`Teen (${e})`:`Young traveler (${e})`).filter(e=>!!e),n=r.length>0?` Age breakdown: ${r.join(", ")}.`:"";t.push(`Travel party: ${s} adult(s), ${o} child(ren).${n} Keep pacing family-friendly with rest time, flexible dining, and safety cues.`)}else t.push(`Travel party: ${s} adult(s). Trip is adults-only; highlight late-night, intimate, or adventurous options when appropriate.`);!0===e.flexibleBudget?t.push("Budget: Flexible. Offer tiered recommendations (value, mid, premium) when relevant."):"number"==typeof e.budget&&t.push(`Budget: Roughly ${e.currency??"USD"} ${e.budget}. Keep suggestions within range unless an upgrade is justified.`);let a=e.travelStyleAnswers??{},l=[],u=(e,t)=>{Array.isArray(t)&&t.length>0&&l.push(`${e}: ${t.join("; ")}`)};if(u("Experience level",a.experience),u("Desired vibes",a.vibes),u("Ideal day patterns",a.sampleDays),u("Dinner preferences",a.dinnerChoices),Array.isArray(a.vibes)&&a.vibes.includes("other")&&a.vibesOther){let e=l.findIndex(e=>e.startsWith("Desired vibes:"));-1!==e&&(l[e]=l[e].replace("other",a.vibesOther.trim()))}if("string"==typeof a.customVibesText&&a.customVibesText.trim()&&l.push(`Custom vibe notes: ${a.customVibesText.trim()}`),"string"==typeof a.otherDinnerChoiceText&&a.otherDinnerChoiceText.trim()&&l.push(`Custom dining notes: ${a.otherDinnerChoiceText.trim()}`),l.length>0?t.push("Detailed travel style signals:\n"+l.map(e=>`- ${e}`).join("\n")):"answer-questions"===e.travelStyleChoice?t.push("Detailed travel style questionnaire submitted without specific selections; infer from other context."):"skip-to-details"===e.travelStyleChoice&&t.push("Traveler skipped the style questionnaire. Infer tone from core preferences, interests, and inclusions."),Array.isArray(e.selectedGroups)&&e.selectedGroups.length>0){let r=e.selectedGroups.join(", ");e.selectedGroups.includes("other")&&e.customGroupText&&(r=r.replace("other",e.customGroupText.trim())),t.push(`Travel group: ${r}.`)}if(Array.isArray(e.selectedInterests)&&e.selectedInterests.length>0){let r=e.selectedInterests.join(", ");e.selectedInterests.includes("other")&&e.customInterestsText&&(r=r.replace("other",e.customInterestsText.trim())),t.push(`Key interests: ${r}.`)}return Array.isArray(e.selectedInclusions)&&e.selectedInclusions.length>0&&(t.push("Must-have inclusions:"),e.selectedInclusions.forEach(r=>{if("string"==typeof r&&r.trim()){let n=r.trim();"other"===n&&e.customInclusionsText&&(n=e.customInclusionsText.trim()),t.push(`- Ensure planning covers: ${n}`)}})),"string"==typeof e.tripNickname&&e.tripNickname.trim()&&t.push(`Trip nickname: ${e.tripNickname.trim()}. Use this nickname in the intro.`),"string"==typeof e.tripVibe&&e.tripVibe.trim()&&t.push(`Primary vibe: ${e.tripVibe.trim()}. Reinforce this tone throughout.`),e.diningPreferences&&t.push(`Dining preferences: ${JSON.stringify(e.diningPreferences)}.`),e.sampleDays&&t.push(`Ideal day structure: ${JSON.stringify(e.sampleDays)}.`),"string"==typeof e.additionalNotes&&e.additionalNotes.trim()&&t.push(`Traveler notes: ${e.additionalNotes.trim()}`),t.push("Execution requirements:"),t.push("- Produce an intro paragraph that feels concierge-written, 2-3 sentences."),t.push("- Build `dailyPlans` array with one entry per day, preserving date order."),t.push("- Each day must include morning, afternoon, evening anchors with 3+ specific activities each."),t.push("- For each time period (morning/afternoon/evening), provide detailed, actionable activities that create a rich experience."),t.push("- Activities should be varied: mix cultural experiences, local interactions, relaxation, exploration, and unique discoveries."),t.push("- If transportation is required, include `transportation` notes with time estimates."),t.push("- Add `dining` suggestions that match the traveler vibe and any dietary notes."),t.push("- Reference the trip nickname if provided."),t.push("- End with `keyTakeaways` summarizing highlights and a `travelTips` array tailored from the traveler form responses."),t.push("- For `travelTips`, output an array where each item is an object containing `title` and `description` strings with practical, concierge-ready guidance."),t.push("- Do not include a `nextSteps` field—focus on personalized travel tips instead."),t.push("Output requirements: Respond with a single JSON object containing `dailyPlans` where each entry represents one day. Each day should include activities, meals, and transportation details."),t.push(`Form data JSON:
${JSON.stringify(e,null,2)}`),t.join("\n\n")}async function s({prompt:e,model:t="grok-4-fast-reasoning",temperature:r=.7}){let i,s;if(!process.env.XAI_API_KEY)throw Error("XAI_API_KEY is not configured.");let l=Date.now(),u=await fetch("https://api.x.ai/v1/responses",{method:"POST",headers:{Authorization:`Bearer ${process.env.XAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:t,input:[{role:"user",content:e}],temperature:r})}),c=u.status,p=await u.text();if(!u.ok)throw n.k.error(17,"XAI_REQUEST_FAILED","lib/ai/architectAI.ts","generateGrokItineraryDraft",p,{responseStatus:c}),Error(`xAI request failed (${c})`);try{i=p?JSON.parse(p):{}}catch(e){throw n.k.error(17,"XAI_INVALID_JSON","lib/ai/architectAI.ts","generateGrokItineraryDraft","Failed to parse xAI JSON response",{responseStatus:c,responseBodyPreview:p.slice(0,600)}),Error("Failed to parse xAI JSON response")}let{text:d,fallbackSource:h}=function(e){if(!e)return{text:null,fallbackSource:"none"};let t=e.output??e.outputs;if(Array.isArray(t)){let e=[];for(let r of t){let t=r?.content??r?.contents;if(Array.isArray(t))for(let r of t)"string"==typeof r?.text&&r.text.trim()&&e.push(r.text.trim());else"string"==typeof t?.text&&t.text.trim()&&e.push(t.text.trim())}if(e.length>0)return{text:e.join("\n\n"),fallbackSource:"none"}}let r=o(e?.choices?.[0]?.message?.content);if(r)return{text:r,fallbackSource:"parsed-content"};let n=e?.choices?.[0]?.message?.tool_calls?.[0]?.function?.arguments;if("string"==typeof n&&n.trim())return{text:n,fallbackSource:"tool-call"};if(n&&"object"==typeof n){let e=JSON.stringify(n);if(e.trim())return{text:e,fallbackSource:"tool-call"}}let i=o(e?.choices?.[0]?.message?.reasoning_content);if(i)return{text:i,fallbackSource:"reasoning"};let s=e?.response?.output_text??e?.text;if("string"==typeof s&&s.trim())return{text:s.trim(),fallbackSource:"parsed-content"};let a=o(e);return a?{text:a,fallbackSource:"parsed-content"}:{text:null,fallbackSource:"none"}}(i);if(n.k.log(16,"XAI_RAW_RESULT","lib/ai/architectAI.ts","generateGrokItineraryDraft",{finishReason:a(i),warnings:i?.warnings,usage:i?.usage,hasText:!!d?.trim?.(),responseKeys:i?Object.keys(i):null}),!d||!d.trim()){if(i?.error?.message)throw Error(`xAI error: ${i.error.message}`);throw n.k.error(17,"XAI_EMPTY_RESPONSE","lib/ai/architectAI.ts","generateGrokItineraryDraft","xAI returned empty text after parsing",{responseStatus:c,responseBodyPreview:p.slice(0,600),parsedKeys:i?Object.keys(i):null}),Error("xAI returned empty text")}let f=function(e){if(!e||!e.trim())throw Error("AI response was empty");let t=e.match(/```json([\s\S]*?)```/i)||e.match(/```([\s\S]*?)```/i),r=t?t[1]:e,n=[r.indexOf("{"),r.indexOf("[")].filter(e=>e>=0),i=[r.lastIndexOf("}"),r.lastIndexOf("]")].filter(e=>e>=0);if(0===n.length||0===i.length)throw Error("Unable to locate JSON payload in AI response");let s=Math.min(...n),o=Math.max(...i);if(!Number.isFinite(s)||!Number.isFinite(o)||s<0||o<s)throw Error("Unable to locate JSON payload in AI response");return r.slice(s,o+1).trim()}(d);try{s=JSON.parse(f)}catch(e){throw Error("Failed to parse Grok itinerary JSON")}return{rawOutput:d,cleanedJson:f,itinerary:s,metadata:{model:t,latencyMs:Date.now()-l,finishReason:a(i),usage:function(e){if(!e||"object"!=typeof e)return;let t={};if("number"==typeof e.input_tokens&&(t.promptTokens=e.input_tokens),"number"==typeof e.output_tokens&&(t.completionTokens=e.output_tokens),"number"==typeof e.total_tokens&&(t.totalTokens=e.total_tokens),0!==Object.keys(t).length)return t}(i?.usage),warnings:i?.warnings,responseStatus:c,responseBodyPreview:p.slice(0,600),fallbackSource:h}}}function o(e){if(!e)return null;if("string"==typeof e)return e.trim()||null;if(Array.isArray(e)){let t=e.map(e=>o(e)).filter(e=>!!e);return t.length>0?t.join(" ").trim():null}if("object"==typeof e){if(null===e)return null;if("string"==typeof e.text)return e.text.trim()||null;if("string"==typeof e.content)return e.content.trim()||null;try{let t=JSON.stringify(e);return t.trim()?t:null}catch{}}return null}function a(e){return e?.output?.[0]?.finish_reason??e?.output?.[0]?.stopReason??e?.finish_reason??e?.finishReason}},1202:(e,t,r)=>{var n,i,s,o,a;r.d(t,{k:()=>u}),function(e){e.USD="USD",e.EUR="EUR",e.GBP="GBP",e.CAD="CAD",e.AUD="AUD"}(n||(n={})),function(e){e.TOTAL="total",e.PER_PERSON="per-person"}(i||(i={})),function(e){e.PENDING="pending",e.PROCESSING="processing",e.COMPLETE="complete",e.ERROR="error"}(s||(s={})),function(e){e.SUCCESS="Success",e.ERROR="Error",e.WARNING="Warning"}(o||(o={})),function(e){e.HIGH="High",e.MEDIUM="Medium",e.LOW="Low"}(a||(a={}));class l{static instance;logLevel;logs=[];maxLogs=1e3;constructor(){this.logLevel=process.env.ITINERARY_LOG_LEVEL||"info"}static getInstance(){return l.instance||(l.instance=new l),l.instance}shouldLog(e){let t=["silent","error","warn","info","debug"],r=t.indexOf(this.logLevel);return t.indexOf(e)<=r}log(e,t,r,n,i={},s,a=o.SUCCESS){if(!this.shouldLog("info"))return;let l={stepNumber:e,action:t,fileName:r,functionName:n,timestamp:new Date().toISOString(),data:i,...void 0!==s&&{duration:s},status:a};this.logs.push(l),this.logs.length>this.maxLogs&&this.logs.shift();try{console.log(`Step ${e}: ${t} in ${r} - ${n}`,l)}catch(r){console.error(`Step ${e}: Logging failed for ${t}`,{error:r instanceof Error?r.message:String(r)})}}error(e,t,r,n,i,s={}){if(!this.shouldLog("error"))return;let a=i instanceof Error?i.message:i;this.log(e,t,r,n,{...s,error:a},void 0,o.ERROR)}warn(e,t,r,n,i,s={}){this.shouldLog("warn")&&this.log(e,t,r,n,{...s,warning:i},void 0,o.WARNING)}debug(e,t,r,n,i={}){this.shouldLog("debug")&&this.log(e,`DEBUG: ${t}`,r,n,i,void 0,o.SUCCESS)}getLogs(){return[...this.logs]}clearLogs(){this.logs=[]}}let u=l.getInstance()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(4548));module.exports=n})();